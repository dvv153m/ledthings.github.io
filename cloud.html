<html>

<head>
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<link rel="stylesheet" href="bootstrap.min.css">
	<script type="text/javascript" src="consts.js"></script>
	<script src="jquery-3.3.1.slim.min.js"></script>
	<script src="bootstrap.min.js"></script>
	<script src="iro.min.js"></script>
	<script type="text/javascript">

		let deviceUrl = "";
		let connection;
		window.onload = function () {

			var item = localStorage.getItem(CurrentDeviceKey);
			var device = JSON.parse(item);
			if (device != null) {

				deviceUrl = device.localIp;

				connection = new WebSocket('ws://' + deviceUrl + ':81/');
				connection.onopen = function () {

					console.log('WebSocket connect', "connect");
					connection.send('Connect ' + new Date());
				};
				connection.onerror = function (error) {

					console.log('WebSocket Error ', error);
				};
				connection.onmessage = function (e) {

					console.log('Server: ', e.data);
				};
				connection.onclose = function () {

					console.log('WebSocket connection closed');
				};

				var colorWheel = iro.ColorPicker("#colorWheelDemo", {
					// options here
				});
				colorWheel.on('color:change', function (color) {
					// when the color has changed, the callback gets passed the color object and an object providing which color channels (out of H, S, V) have changed.
					//grb
					var g = color.rgb.r ** 2 / 255;
					var r = color.rgb.g ** 2 / 255;
					var b = color.rgb.b ** 2 / 255;

					var rgb = r << 20 | g << 10 | b;
					var rgbstr = '#' + rgb.toString(16);					
					connection.send(rgbstr);
				})
			}
		};

		function sendRGB() {
			var r = document.getElementById('r').value ** 2 / 255;
			var r1 = document.getElementById('r').value;
			var r2 = document.getElementById('r').value * 2 / 255;

			var g = document.getElementById('g').value ** 2 / 255;
			var b = document.getElementById('b').value ** 2 / 255;

			var rgb = r << 20 | g << 10 | b;
			var rgbstr = '#' + rgb.toString(16);
			//console.log('RGB: ' + rgbstr);
			connection.send(rgbstr);
		}

		function sendCommand(mode, val) {

			if (!IsDebug) {
				var commandUrl = "http://" + deviceUrl + "/ledthings?mode=" + mode + "&val=" + val;
				fetchData(commandUrl);
			}
			else { }
		}

		function playStop(mode, nameId) {

			if (document.getElementById(nameId).innerHTML == "Play") {

				document.getElementById(nameId).innerHTML = "Stop";
				sendCommand(mode, DirectionType.Play);
			}
			else {

				document.getElementById(nameId).innerHTML = "Play";
				sendCommand(mode, DirectionType.Stop);
			}
		}

		function resetCommand() {

			var resetUrl = "http://" + deviceUrl + "/reset";
			fetchData(resetUrl);
		}
	</script>
</head>

<body>
	<br />
	<ul class="nav nav-tabs" id="myTab" role="tablist">
		<li class="nav-item">
			<a class="nav-link active" id="color-tab" data-toggle="tab" href="#color" role="tab" aria-controls="color"
				aria-selected="true">Colors</a>
		</li>
		<li class="nav-item">
			<a class="nav-link" id="gradient-tab" data-toggle="tab" href="#gradient" role="tab" aria-controls="gradient"
				aria-selected="false">Gradients</a>
		</li>
		<li class="nav-item">
			<a class="nav-link" id="animation-tab" data-toggle="tab" href="#animation" role="tab"
				aria-controls="animation" aria-selected="false">Animations</a>
		</li>
	</ul>
	<div class="tab-content" id="myTabContent">
		<div class="tab-pane fade show active" id="color" role="tabpanel" aria-labelledby="home-tab">
			<br />
			<button type="button" class="btn btn-light"
				onclick="sendCommand(ModeType.Color, DirectionType.Previous)">Previous</button>
			<button type="button" class="btn btn-light" onclick="playStop(ModeType.Color, 'colorPlayStop')"
				id="colorPlayStop">Play</button>
			<button type="button" class="btn btn-light"
				onclick="sendCommand(ModeType.Color, DirectionType.Next)">Next</button>

			<div class="wheel" id="colorWheelDemo"></div>			
		</div>
		<div class="tab-pane fade" id="gradient" role="tabpanel" aria-labelledby="gradient-tab">
			<div class="tab-pane fade show active" id="color" role="tabpanel" aria-labelledby="home-tab">
				<br />
				<button type="button" class="btn btn-light"
					onclick="sendCommand(ModeType.Gradient, DirectionType.Previous)">Previous</button>
				<button type="button" class="btn btn-light" onclick="playStop(ModeType.Gradient, 'gradientPlayStop')"
					id="gradientPlayStop">Play</button>
				<button type="button" class="btn btn-light"
					onclick="sendCommand(ModeType.Gradient, DirectionType.Next)">Next</button>
			</div>
		</div>
		<div class="tab-pane fade" id="animation" role="tabpanel" aria-labelledby="animation-tab">
			<div class="tab-pane fade show active" id="color" role="tabpanel" aria-labelledby="home-tab">
				<br />
				<button type="button" class="btn btn-light"
					onclick="sendCommand(ModeType.Animation, DirectionType.Previous)">Previous</button>
				<button type="button" class="btn btn-light" onclick="playStop(ModeType.Animation, 'animationPlayStop')"
					id="animationPlayStop">Stop</button>
				<button type="button" class="btn btn-light"
					onclick="sendCommand(ModeType.Animation, DirectionType.Next)">Next</button>
			</div>
		</div>
	</div>
	</div>
	<br />
	<a href="index.html">Device list</a><br />
	<button type="button" class="btn btn-light" onclick="resetCommand()">Reset</button>
</body>

</html>