<html>

<head>
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css">
	<script type="text/javascript" src="consts.js"></script>
	<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>
	<!-- <script type="text/javascript">
		initBootstrap(document.body);
	</script> -->

	<script type="text/javascript">

		let deviceUrl = "";
		let connection;
		window.onload = function () {

			var item = localStorage.getItem(CurrentDeviceKey);
			var device = JSON.parse(item);
			if (device != null) {

				deviceUrl = device.localIp;

				//var connection = new WebSocket('ws://' + location.hostname + ':81/', ['arduino']);
				connection = new WebSocket('ws://' + deviceUrl + ':81/');
				connection.onopen = function () {

					console.log('WebSocket connect', "connect");
					connection.send('Connect ' + new Date());
				};
				connection.onerror = function (error) {

					console.log('WebSocket Error ', error);
				};
				connection.onmessage = function (e) {

					console.log('Server: ', e.data);
				};
				connection.onclose = function () {

					console.log('WebSocket connection closed');
				};
			}
		};

		function sendRGB() {
			var r = document.getElementById('r').value ** 2 / 255;
			var g = document.getElementById('g').value ** 2 / 255;
			var b = document.getElementById('b').value ** 2 / 255;

			var rgb = r << 20 | g << 10 | b;
			var rgbstr = '#' + rgb.toString(16);
			//console.log('RGB: ' + rgbstr);
			connection.send(rgbstr);
		}

		function sendCommand(mode, val) {

			if (!IsDebug) {
				var commandUrl = "http://" + deviceUrl + "/ledthings?mode=" + mode + "&val=" + val;
				fetchData(commandUrl);
			}
			else {

			}
			/*var restoredSession = JSON.parse(localStorage.getItem('session'));
			restoredSession.devices.push({ 'localIp': "192.168.1.2", 'deviceType': 3 });
			localStorage.setItem('session', JSON.stringify(restoredSession));*/
			//window.location.href = 'login.html';
		}

		function playStop(mode, nameId) {

			if (document.getElementById(nameId).innerHTML == "Play") {
				
				document.getElementById(nameId).innerHTML = "Stop";
				sendCommand(mode, DirectionType.Play);
			}
			else {

				document.getElementById(nameId).innerHTML = "Play";
				sendCommand(mode, DirectionType.Stop);
			}
		}
	</script>
</head>

<body>
	<br />
	<ul class="nav nav-tabs" id="myTab" role="tablist">
		<li class="nav-item">
			<a class="nav-link active" id="color-tab" data-toggle="tab" href="#color" role="tab" aria-controls="color"
			 aria-selected="true">Colors</a>
		</li>
		<li class="nav-item">
			<a class="nav-link" id="gradient-tab" data-toggle="tab" href="#gradient" role="tab" aria-controls="gradient"
			 aria-selected="false">Gradients</a>
		</li>
		<li class="nav-item">
			<a class="nav-link" id="animation-tab" data-toggle="tab" href="#animation" role="tab" aria-controls="animation"
			 aria-selected="false">Animations</a>
		</li>
	</ul>
	<div class="tab-content" id="myTabContent">
		<div class="tab-pane fade show active" id="color" role="tabpanel" aria-labelledby="home-tab">
			<button type="button" class="btn btn-light" onclick="sendCommand(ModeType.Color, DirectionType.Previous)">Previous</button>
			<button type="button" class="btn btn-light" onclick="playStop(ModeType.Color, 'colorPlayStop')" id="colorPlayStop">Play</button>
			<button type="button" class="btn btn-light" onclick="sendCommand(ModeType.Color, DirectionType.Next)">Next</button>
			<div style="margin:20px">
				<table>
					<tr>
						<td style="width:14.4px; text-align: right">R: </td>
						<td><input class="enabled" id="r" type="range" min="0" max="255" step="1" oninput="sendRGB();" value="0"></td>
					</tr>
					<tr>
						<td style="width:14.4px; text-align: right">G: </td>
						<td><input class="enabled" id="g" type="range" min="0" max="255" step="1" oninput="sendRGB();" value="0"></td>
					</tr>
					<tr>
						<td style="width:14.4px; text-align: right">B: </td>
						<td><input class="enabled" id="b" type="range" min="0" max="255" step="1" oninput="sendRGB();" value="0"></td>
					</tr>
				</table>
			</div>
		</div>
		<div class="tab-pane fade" id="gradient" role="tabpanel" aria-labelledby="gradient-tab">
			<div class="tab-pane fade show active" id="color" role="tabpanel" aria-labelledby="home-tab">
				<button type="button" class="btn btn-light" onclick="sendCommand(ModeType.Gradient, DirectionType.Previous)">Previous</button>
				<button type="button" class="btn btn-light" onclick="playStop(ModeType.Gradient, 'gradientPlayStop')" id="gradientPlayStop">Play</button>
				<button type="button" class="btn btn-light" onclick="sendCommand(ModeType.Gradient, DirectionType.Next)">Next</button>
			</div>
		</div>
		<div class="tab-pane fade" id="animation" role="tabpanel" aria-labelledby="animation-tab">
			<div class="tab-pane fade show active" id="color" role="tabpanel" aria-labelledby="home-tab">
				<button type="button" class="btn btn-light" onclick="sendCommand(ModeType.Animation, DirectionType.Previous)">Previous</button>
				<button type="button" class="btn btn-light" onclick="playStop(ModeType.Animation, 'animationPlayStop')" id="animationPlayStop">Stop</button>
				<button type="button" class="btn btn-light" onclick="sendCommand(ModeType.Animation, DirectionType.Next)">Next</button>
			</div>
		</div>
	</div>
	</div>
	<br />
	<a href="index.html">Device list</a>
</body>

</html>